<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title>Add Expense - Smart Expense Splitter</title>
  <style>
    /* ðŸŒ¸ Global Colors & Text */
:root {
  --primary: #e91e63;
  --primary-hover: #d81b60;
  --bg-light: #fff5f8;
  --border-soft: #f0b0bd;
  --text-dark: #333;
  --shadow-soft: 0 4px 10px rgba(233, 30, 99, 0.15);
}

body {
  background: var(--bg-light);
  font-family: 'Poppins', sans-serif;
  color: var(--text-dark);
}

/* ðŸŒ¸ Header Title */
h2.text-pink {
  font-weight: 600;
  font-size: 2.1rem;
  color: rgb(230, 120, 142);
  letter-spacing: 2px;
  font-family: 'Pacifico', cursive, sans-serif;
}

/* ðŸŒ¸ Card Styling */
.card {
  border: none;
  border-radius: 20px;
  background-color: #fff;
  box-shadow: var(--shadow-soft);
  transition: transform 0.2s ease, box-shadow 0.3s ease;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(233, 30, 99, 0.25);
}

/* ðŸŒ¸ Labels */
.form-label {
  color: var(--primary);
  font-weight: 600;
}

/* ðŸŒ¸ Inputs, Selects & Textareas */
.form-control,
.form-select {
  border: 2px solid var(--border-soft);
  border-radius: 25px;
  padding: 10px 16px;
  transition: all 0.3s ease;
  font-weight: 500;
}

.form-control:focus,
.form-select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 0.2rem rgba(233, 30, 99, 0.2);
  outline: none;
}

/* ðŸŒ¸ Select dropdown custom arrow */
.form-select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg fill='%23e91e63' height='16' width='16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5.5 6l2.5 2.5L10.5 6z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 18px center;
  background-size: 12px;
}

/* ðŸŒ¸ Textarea */
textarea.form-control {
  resize: none;
  border-radius: 20px;
}

/* ðŸŒ¸ Buttons */
.btn-gradient {
  background: linear-gradient(45deg, #e91e63, #f48fb1);
  border: none;
  color: #fff;
  font-weight: 600;
  border-radius: 25px;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-soft);
}

.btn-gradient:hover {
  background: linear-gradient(45deg, #d81b60, #ec407a);
  transform: translateY(-1px);
  box-shadow: 0 4px 14px rgba(233, 30, 99, 0.3);
}

/* Cancel link */
a.text-pink {
  font-weight: 600;
  color: var(--primary);
}
a.text-pink:hover {
  color: var(--primary-hover);
  text-decoration: underline;
}

/* ðŸŒ¸ Alerts */
.alert {
  border-radius: 15px;
}

/* ðŸŒ¸ Responsive */
@media (max-width: 768px) {
  .card {
    padding: 20px;
  }

  h2.text-pink {
    font-size: 1.5rem;
  }

  .btn-gradient {
    font-size: 1rem;
  }
}
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

<%
  // defensive defaults to avoid runtime errors when route doesn't pass values
  groups = (typeof groups !== 'undefined') ? groups : [];
  user = (typeof user !== 'undefined') ? user : null;
  message = (typeof message !== 'undefined') ? message : null;
%>

<%- include('./partials/navbar', { activePage: 'expenses', userId: userId }) %>

<!-- attach groups JSON to a data attribute to avoid inline EJS in JS -->
<div id="app" class="container py-5 flex-grow-1" data-groups='<%- JSON.stringify(groups || []) %>'>
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h2 class="fw-bold text-center text-pink mb-4">Add a New Expense ðŸ’¸</h2>

      <% if (message) { %>
        <div class="alert alert-danger"><%= message %></div>
      <% } %>

      <div class="card p-4 shadow-sm">
        <form action="/expenses" method="POST">
          <div class="mb-3">
            <label for="group" class="form-label fw-bold">For Which Group?</label>
            <% if (groups && groups.length > 0) { %>
              <select id="group" name="group" class="form-select" required>
                <option value="" disabled selected>Select a group...</option>
                <% groups.forEach(g => { %>
                  <option value="<%= g._id %>"><%= g.name %></option>
                <% }) %>
              </select>
            <% } else { %>
              <div class="alert alert-warning small m-0">
                You must <a href="/groups/new" class="alert-link">create a group</a> before adding an expense.
              </div>
            <% } %>
          </div>

          <div class="mb-3">
            <label for="amount" class="form-label fw-bold">Amount (â‚¹)</label>
            <input id="amount" name="amount" type="number" step="0.01" class="form-control" required>
          </div>

          <div class="mb-3">
            <label for="date" class="form-label fw-bold">Date</label>
            <input id="date" name="date" type="date" class="form-control" value="<%= new Date().toISOString().split('T')[0] %>" required>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label fw-bold">Description</label>
            <textarea id="description" name="description" class="form-control" rows="3"></textarea>
          </div>

          <button type="submit" class="btn btn-gradient w-100" <%= (groups && groups.length > 0) ? '' : 'disabled' %>>Add Expense</button>
          <a href="/expenses" class="btn btn-link w-100 mt-2 text-pink text-decoration-none">Cancel</a>
        </form>
      </div>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // parse groups from the data attribute (avoids EJS tokens inside JS expressions)
  (function(){
    const appEl = document.getElementById('app');
    const __groups = appEl ? JSON.parse(appEl.dataset.groups || '[]') : [];
    console.log('DEBUG groups:', __groups);
    console.log('DEBUG groupsCount:', __groups.length);
  })();
</script>
</body>
</html>
