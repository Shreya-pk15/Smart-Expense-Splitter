<nav class="navbar navbar-expand-lg py-3">
  <div class="container">
    <h4 class="fw-bold">Smart Expense Splitter</h4>
    <link rel="stylesheet" href="/styles/navbar.css">

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center">
        <% if (!user) { %>
          <li class="nav-item"><a class="nav-link" href="/register">Sign Up</a></li>
          <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
        <% } else { %>
          <li class="nav-item"><a class="nav-links <%= activePage === 'home' ? 'active' : '' %>" href="/home">Home</a></li>
          <li class="nav-item"><a class="nav-links <%= activePage === 'groups' ? 'active' : '' %>" href="/groups">Groups</a></li>
          <li class="nav-item"><a class="nav-links <%= activePage === 'expenses' ? 'active' : '' %>" style="margin-right: 18px;" href="/expenses">Expenses</a></li>
          <li class="nav-item"><a class="nav-links <%= activePage === 'about' ? 'active' : '' %>" href="/about">About</a></li>

          <!-- Profile Dropdown -->
          <li class="nav-item dropdown ms-3">
            <div class="dropdown">
              <div class="profile-trigger" onclick="toggleDropdown(event)">
                <img
                  src="<%= user.profilePic
                    ? '/uploads/' + user.profilePic
                    : 'https://i.pinimg.com/1200x/8b/84/17/8b841799752db5b6e1aa1aa56fe737db.jpg' %>"
                  alt="Profile"
                  class="profile-avatar"
                />
              </div>

              <div id="profileDropdown" class="dropdown-content shadow-lg">
                <a href="/profile"><i class="bi bi-person-circle"></i> Profile</a>
                <a href="/setting"><i class="bi bi-gear"></i> Settings</a>
                <form id="logoutForm" action="/logout" method="POST" style="display:inline;">
                  <button type="button" class="dropdown-logout" data-bs-toggle="modal" data-bs-target="#logoutModal">
                    <i class="bi bi-box-arrow-right"></i> Logout
                  </button>
                </form>
              </div>
            </div>
          </li>
        <% } %>
      </ul>
    </div>
  </div>
</nav>

<!-- ðŸŒ¸ Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content logout-modal text-center shadow-lg">
      <div class="modal-header border-0 justify-content-center">
        <h5 class="modal-title fw-bold fs-4 logout-title" id="logoutModalLabel">
          Are you sure you want to logout?
        </h5>
      </div>
      <div class="modal-body">
        <p class="text-muted mb-4">Youâ€™ll be signed out from Smart Expense Splitter ðŸ’—</p>
        <div class="d-flex justify-content-center gap-3">
          <button type="button" class="btn cancel-btn" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn confirm-logout-btn" onclick="logoutUser()">Logout</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // âœ… Toggle dropdown (fixed version)
  function toggleDropdown(event) {
    event.stopPropagation(); // Prevents it from instantly closing
    const dropdown = document.getElementById("profileDropdown");
    dropdown.classList.toggle("show");
  }

  // âœ… Close dropdown when clicking outside
  document.addEventListener("click", (event) => {
    const dropdown = document.getElementById("profileDropdown");
    const trigger = document.querySelector(".profile-trigger");
    if (!dropdown.contains(event.target) && !trigger.contains(event.target)) {
      dropdown.classList.remove("show");
    }
  });

  // âœ… Logout handler
  function logoutUser() {
    document.getElementById("logoutForm").submit();
  }
</script>
