<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Expense Splitter</title>
  <link rel="stylesheet" href="/styles/style.css">
  <!-- Bootstrap CSS -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous"
/>

<!-- Bootstrap Icons (since you use bi bi-person-circle etc.) -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
/>

  <style>
:root {
  --primary: #f43e5c;
  --primary-hover: #e03553;
  --bg-light: #fff7f9;
  --bg-card: #ffffff;
  --border: #f2c8d2;
  --text: #2b2b2b;
  --muted: #757575;
  --radius: 14px;
  --shadow: 0 6px 18px rgba(233, 30, 99, 0.08);
  --transition: all 0.3s ease;
  --sidebar-width: 280px;
  --font: 'Poppins', sans-serif;
}

/* üå∏ Base */
body {
  font-family: var(--font);
  background: var(--bg-light);
  color: var(--text);
  margin: 0;
  overflow-x: hidden;
}

/* üå∏ Wrapper */
.settings-wrapper {
  display: flex;
  min-height: 100vh;
}

/* üå∏ Sidebar */
.settings-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  width: var(--sidebar-width);
  background: linear-gradient(180deg, #ffe5ef, #fff);
  border-right: 1px solid var(--border);
  box-shadow: 3px 0 8px rgba(244, 62, 92, 0.08);
  padding: 25px 20px;
  margin-top: 70px;
  display: flex;
  flex-direction: column;
  animation: slideIn 0.4s ease;
}

.settings-sidebar h3 {
  text-align: center;
  font-family: 'Pacifico', cursive;
  color: var(--primary);
  font-size: 1.9rem;
  margin-bottom: 30px;
}

.settings-sidebar ul {
  list-style: none;
  padding: 0;
}

.settings-sidebar button {
  width: 100%;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 1rem;
  color: var(--primary);
  font-weight: 500;
  padding: 13px 16px;
  margin-bottom: 10px;
  text-align: left;
  cursor: pointer;
  transition: var(--transition);
}

.settings-sidebar button:hover,
.settings-sidebar button.active {
  background: linear-gradient(90deg, var(--primary), var(--primary-hover));
  color: #fff;
  box-shadow: 0 3px 12px rgba(244, 62, 92, 0.3);
  transform: translateX(5px);
}

/* üå∏ Main Section */
.settings-main {
  flex-grow: 1;
  margin-left: 260px;
  padding: 60px 70px;
  display: flex;
  justify-content: center;
  background: var(--bg-light);
}

.settings-container {
  background: var(--bg-card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 50px;
  width: 100%;
  max-width: 800px;
  height: 540px;
  animation: fadeIn 0.5s ease;
}

/* üå∏ Sections */
.setting-section {
  display: none;
  animation: fadeIn 0.6s ease;
}
.setting-section.active {
  display: block;
}

.setting-section h2,
.setting-section h3 {
  color: var(--primary);
  font-weight: 700;
  margin-bottom: 25px;
  text-align: center;
}

/* üå∏ Inputs & Textareas */
.settings-container input,
.settings-container textarea {
  width: 100%;
  padding: 12px 16px;
  border: 1.8px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  transition: var(--transition);
  font-size: 1rem;
  background: #fff;
}

.settings-container input:focus,
.settings-container textarea:focus {
  border-color: var(--primary);
  box-shadow: 0 0 6px rgba(244, 62, 92, 0.2);
  outline: none;
}

/* üå∏ Password toggle */
.password-group {
  position: relative;
}

.toggle-btn {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  border: none;
  background: none;
  color: var(--primary);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.toggle-btn:hover {
  color: var(--primary-hover);
}

.strength-text {
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: -5px;
  margin-bottom: 10px;
  font-weight: 500;
}

/* üå∏ Buttons */
.btn-gradient {
  background: linear-gradient(90deg, var(--primary), var(--primary-hover));
  border: none;
  color: #fff;
  font-weight: 600;
  border-radius: var(--radius);
  padding: 12px 16px;
  transition: var(--transition);
  width: 100%;
  box-shadow: 0 3px 10px rgba(244, 62, 92, 0.25);
}

.btn-gradient:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(244, 62, 92, 0.3);
}

/* üå∏ FAQ */
.faq-container {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.faq-item {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 18px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.04);
  cursor: pointer;
  transition: var(--transition);
}

.faq-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.06);
}

.faq-question {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: var(--primary);
  font-weight: 600;
}

.faq-answer {
  max-height: 0;
  overflow: hidden;
  transition: all 0.4s ease;
  color: var(--text);
  line-height: 1.6;
}

.faq-item.active .faq-answer {
  max-height: 300px;
  padding-top: 8px;
}

/* üå∏ Toast Notification */
.toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: #fff;
  padding: 16px 22px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  opacity: 0;
  transform: translateY(20px);
  transition: var(--transition);
  z-index: 9999;
  font-weight: 500;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast.success {
  border-left: 5px solid #4caf50;
  color: #256029;
}

.toast.error {
  border-left: 5px solid #f44336;
  color: #a21b1b;
}

/* üå∏ Navbar */
nav {
  background: linear-gradient(90deg, var(--primary), var(--primary-hover));
  box-shadow: 0 3px 10px rgba(244, 62, 92, 0.25);
}

nav a.nav-links {
  color: #fff !important;
  font-weight: 600;
  padding: 8px 14px;
  margin-left: 10px;
  border-radius: 10px;
  text-decoration: none;
  transition: background-color 0.3s ease;
}

nav a.nav-links:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

.navbar-brand, h4.fw-bold {
  color: #fff !important;
}

/* üå∏ Profile Dropdown */
.profile-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #fff;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.profile-avatar:hover {
  transform: scale(1.05);
}

.dropdown-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: #fff;
  min-width: 160px;
  border-radius: 10px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  z-index: 1000;
  overflow: hidden;
}

.dropdown-content a,
.dropdown-content button {
  color: #333;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  font-size: 1rem;
  transition: background-color 0.2s ease;
}

.dropdown-content a:hover,
.dropdown-content button:hover {
  background-color: #f8f8f8;
}

.dropdown.show .dropdown-content {
  display: block;
}

/* üå∏ Responsive */
@media (max-width: 992px) {
  .settings-wrapper {
    flex-direction: column;
  }

  .settings-sidebar {
    position: relative;
    flex-direction: row;
    justify-content: space-evenly;
    width: 100%;
    margin-top: 0;
    border-bottom: 1px solid var(--border);
  }

  .settings-sidebar h3 {
    display: none;
  }

  .settings-main {
    margin-left: 0;
    padding: 40px 25px;
  }

  .settings-container {
    padding: 30px 25px;
  }
}

/* üå∏ Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
  from { transform: translateX(-15px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
/* --- Buttons --- */
.btn-gradient {
  background: linear-gradient(135deg, #e91e63, #ff4081);
  border: none;
  color: white;
  font-weight: 600;
  border-radius: 50px;
  padding: 10px 0;
  box-shadow: 0 4px 10px rgba(233, 30,
  99, 0.3);
  transition: all 0.3s ease;
}
.btn-gradient:hover {
  background: linear-gradient(135deg, #d81b60, #ff1c70);
  box-shadow: 0 6px 14px rgba(233, 30, 99, 0.35);
  transform: translateY(-2px);
}
/* --- Form Controls --- */
.form-control {
  border-radius: 50px;
  border: 1.5px solid #f8bbd0;
  padding: 10px 20px;
  transition: all 0.3s ease;
}
.form-control:focus {
  border-color: #e91e63;
  box-shadow: 0 0 0 0.2rem rgba(233, 30, 99, 0.2);
}
 </style>
</head>

<body>
  <!-- Include Navbar -->
  <%- include('./partials/navbar', { activePage: 'settings', userId: user ? user._id : null }) %>

  <!-- Settings Wrapper -->
  <div class="settings-wrapper">
    <!-- Sidebar -->
    <aside class="settings-sidebar">
      <h3>Settings ‚öôÔ∏è</h3>
      <ul>
        <li><button class="active" onclick="showSection('password')">Change Password</button></li>
        <li><button onclick="showSection('faq')">FAQs</button></li>
        <li><button onclick="showSection('contact')">Contact</button></li>
      </ul>
    </aside>

    <!-- Main -->
    <main class="settings-main">
      <div class="settings-container">

        <!-- Change Password -->
        <section id="password" class="setting-section active">
          <h3>Change Password üîí</h3>
          <form id="passwordForm" style="max-width: 450px; margin:auto;">
            <label>Current Password</label>
            <div class="password-group">
              <input type="password" id="currentPassword" required />
              <button type="button" class="toggle-btn" onclick="togglePassword('currentPassword', this)">Show</button>
            </div>

            <label>New Password</label>
            <div class="password-group">
              <input type="password" id="newPassword" required oninput="checkStrength()" />
              <button type="button" class="toggle-btn" onclick="togglePassword('newPassword', this)">Show</button>
            </div>
            <div id="passwordStrength" class="strength-text"></div>

            <label>Confirm New Password</label>
            <div class="password-group">
              <input type="password" id="confirmPassword" required />
              <button type="button" class="toggle-btn" onclick="togglePassword('confirmPassword', this)">Show</button>
            </div>
            <div id="passwordMatchMsg" class="strength-text"></div>

            <button type="submit" class="btn-gradient mt-3">Update Password</button>
          </form>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="setting-section">
          <h2>FAQs ‚ùì</h2>
          <div class="faq-container">
            <div class="faq-item">
              <div class="faq-question">üí∞ How does splitting work?<span>‚ñº</span></div>
              <div class="faq-answer">The app calculates each person's share fairly and transparently based on total expenses.</div>
            </div>
            <div class="faq-item">
              <div class="faq-question">üì± Can I use this on mobile?<span>‚ñº</span></div>
              <div class="faq-answer">Yes! The app is fully responsive across all devices.</div>
            </div>
            <div class="faq-item">
              <div class="faq-question">üîê Is my data safe?<span>‚ñº</span></div>
              <div class="faq-answer">Absolutely! Data is encrypted and never shared externally.</div>
            </div>
            <div class="faq-item">
              <div class="faq-question">üë• Can I invite friends?<span>‚ñº</span></div>
              <div class="faq-answer">Yes! Create groups and invite friends by email to manage shared expenses.</div>
            </div>
          </div>
        </section>

<!-- Contact Section -->
<section id="contact" class="setting-section">
  <h2>Contact Us üì¨</h2>
  <p style="text-align:center;color:var(--muted);margin-bottom:20px;">
    We‚Äôd love to hear your feedback!
  </p>
  <form id="contactForm" style="max-width:500px;margin:auto;">
    <input type="text" id="name" name="name" placeholder="Your Name" required />
    <input type="email" id="email" name="email" placeholder="Your Email" required />
    <textarea id="message" name="message" rows="4" placeholder="Type your message..." required></textarea>
    <button type="submit" class="btn-gradient mt-3">Send Message üíå</button>
  </form>
</section>

<!-- Toast notification -->
<div id="toast" class="toast"></div>

<script>
  function showSection(id) {
    document.querySelectorAll('.setting-section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.settings-sidebar button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
  }

  function togglePassword(id, btn) {
    const f = document.getElementById(id);
    f.type = f.type === "password" ? "text" : "password";
    btn.textContent = f.type === "password" ? "Show" : "Hide";
  }

  function checkStrength() {
    const p = document.getElementById("newPassword").value;
    const t = document.getElementById("passwordStrength");
    let s = 0;
    if (p.length >= 8) s++;
    if (/[A-Z]/.test(p)) s++;
    if (/[0-9]/.test(p)) s++;
    if (/[^A-Za-z0-9]/.test(p)) s++;
    const msg = ["Weak üíî", "Medium üíõ", "Strong üí™", "Very Strong üî•"];
    const col = ["#ff6f91", "#ffb347", "#6fd37f", "#2ecc71"];
    t.textContent = msg[s - 1] || "";
    t.style.color = col[s - 1] || "";
  }

  document.getElementById("confirmPassword")?.addEventListener("input", function () {
    const newP = document.getElementById("newPassword").value;
    const msg = document.getElementById("passwordMatchMsg");
    msg.textContent = this.value === newP ? "‚úÖ Passwords match" : "‚ùå Passwords do not match";
    msg.style.color = this.value === newP ? "#6fd37f" : "#ff6f91";
  });

  document.querySelectorAll('.faq-item').forEach(f =>
    f.addEventListener('click', () => f.classList.toggle('active'))
  );

  // üíå Contact form logic
  const form = document.getElementById("contactForm");
  const toast = document.getElementById("toast");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
      name: document.getElementById("name").value.trim(),
      email: document.getElementById("email").value.trim(),
      message: document.getElementById("message").value.trim(),
    };

    try {
      const res = await fetch("/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      const result = await res.json();

      if (result.success) {
        showToast("Message sent successfully! üíå", "success");
        form.reset();
      } else {
        showToast(result.message || "Something went wrong üò¢", "error");
      }
    } catch (err) {
      console.error(err);
      showToast("Server error. Try again later.", "error");
    }
  });

  function showToast(message, type) {
    toast.textContent = message;
    toast.className = "toast show " + type;
    setTimeout(() => toast.className = "toast", 3000);
  }

document.getElementById("passwordForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const currentPassword = document.getElementById("currentPassword").value;
  const newPassword = document.getElementById("newPassword").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  if (newPassword !== confirmPassword) {
    document.getElementById("passwordMatchMsg").textContent = "Passwords do not match!";
    return;
  }

  try {
    const res = await fetch("/update-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ currentPassword, newPassword }),
    });

    const data = await res.json();
    if (data.success) {
      showToast("‚úÖ Password updated successfully! Redirecting...", "success");
      setTimeout(() => window.location.href = "/login", 1500);
    } else {
      alert("‚ö†Ô∏è " + data.message);
    }
  } catch (err) {
    console.error(err);
    alert("Something went wrong. Please try again.");
  }
});
</script>
</body>
</html>